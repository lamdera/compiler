
### Compiler extension: Wire/Evergreen

Wire is a compiler extension that automatically generates encoders and decoders for data types using Evergreen (see relevant [talk by Mario](https://www.youtube.com/watch?v=4T6nZffnfzg)).

- Custom types are encoded as a list containing the custom type tag lexicographical index as first element and all parameters as subsequent elements
- Records are encoded as a list containing all the encoded field values in order with no labels

That's it!

The above code is now what gets silently generated by Wire/Evergreen in the background. So for a given type `AllTypes`, the functions `w2_encode_AllTypes` and `w2_decode_AllTypes` will be automatically generated and available during compilation.

Given we control both encoder/decoder, we can rely on the knowledge of how we encoded things to decode them, thus removing the need for keeping redundant intermediary labels.

#### Compiler modifications for Wire to work

Generated encoders/decoders must:

- `import Lamdera.Wire2` is injected into all modules that need wire injections
- The generated encoder/decoders are injected into `exposing ()` so they can be reached
- Remove generated encoder/decoders from the `compiler/src/Elm/Docs.hs` checks for correct documentation (as there are none, and Elm throws warnings otherwise)


#### How to develop wire

- See extra/Wire/Source2.hs
- Use the `test/v1` app as it has `AllTypes_Check.elm` which tests on 2 levels
  - 1. If it even compiles after wire injections
  - 2. Actually boot it up and see the UI based testing work, which does a wire encode/decode round trip for elaborate value examples
